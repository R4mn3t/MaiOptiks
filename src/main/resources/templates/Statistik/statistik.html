<!DOCTYPE html>
<html lang="de" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}"></title>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" th:href="@{/css/statistik-style.css}"/>
    <script th:src="@{/scripts/main.js}" type="text/javascript"></script>
</head>

<body>
<div class="title-bar">
    <h1 class="heading">Statistik</h1>
</div>

<div class="vertical-bar">
    <p></p>
</div>

<div class="header-button">
    <button class=" button button-startseite" onclick="openLink('/')">Startseite</button>
    <button class=" button button-startseite" onclick="Laden()">Laden</button>
    <hr class="linetop">
</div>


<div class = "statistik">
    <div>
        <h4>Kunden-Statistk</h4>
        <br>
        <h4 id = AnzKund>Anzahl Kunden:</h4>
        <h4 id = AnzKund20>Anzahl Kunden (0-20 Jahren):</h4>
    </div>
    <div>
        <h4>.</h4>
        <br>
        <h4 id = Alter>Durchschnittsalter:</h4>
        <h4 id = AnzKund40>Anzahl Kunden (21-40 Jahren):</h4>
    </div>
    <div>
        <h4>.</h4>
        <br>
        <h4>.</h4>
        <h4 id = AnzKund60>Anzahl Kunden (41-60 Jahren):</h4>
    </div>
    <div>
        <h4>.</h4>
        <br>
        <h4>.</h4>
        <h4 id = AnzKund80>Anzahl Kunden (61-80 Jahren):</h4>
    </div>
    <div>    
        <h4>.</h4>
        <br>
        <h4>.</h4>
        <h4 id = AnzKund99>Anzahl Kunden (81+ Jahren):</h4>
    </div>
</div> 
<hr class="linebottom">
<div class = "statistik">
    <div>
        <h4>Auftrags-Statistik</h4>
        <br>
        <h4 id = anzAuftrag>Anzahl Aufträge:</h4>
    </div>
    <div>
        <h4>.</h4>
        <br>
        <h4 id = anzAuftragKund>Anzahl Aufträge pro Kunde:</h4>
    </div>
</div>

</body>
<script>

    function Laden(){
        Kunden();
        Auftrag();
    }
    //Kunden Statistik
    function Kunden(){
        doGetRequest(
            '/api/kundes',
            "",
            (data) => {   // func
                anzKundenZeig(data);
                Altersdurschschnitt(data);
            }); 
    }
    function anzKundenZeig(data){
        document.getElementById("AnzKund").innerHTML = "Anzahl Kunden: " + data.length + " Kunden";
        let kund20 = 0;
        let kund40 = 0;
        let kund60 = 0;
        let kund80 = 0;
        let kund99 = 0;
        let jahr = new Date().getFullYear();
        let monat = (new Date().getMonth()) + 1;
        let tag = new Date().getDate();
        for (let i = 0; i < data.length; i++) {
            geb = data[i].geburtsdatum;
            gebjahr = JSON.stringify(geb);
            gebjahr = gebjahr.substring(1, 5);
            gebjahr = parseInt(gebjahr)
            gebmonat = JSON.stringify(geb)
            gebmonat = geb.substring(6, 8);
            gebmonat = parseInt(gebmonat);
            gebtag = JSON.stringify(geb)
            gebtag = gebtag.substring(9, 11);
            gebtag = parseInt(gebtag);
            if(monat <= gebmonat && tag <= gebtag ){
                jahr = jahr - 1;
            };
            alt = jahr - gebjahr;
            if (alt < 21){
                kund20 = kund20 + 1;
            }else if (alt < 41 && alt > 20){
                kund40 = kund40 + 1;
            }else if (alt < 61 && alt > 40){
                kund60 = kund60 + 1;
            }else if (alt < 81 && alt > 60){
                kund80 = kund80 + 1;
            }else if (alt > 80){
                kund99 = kund99 + 1;
            }
        }
        document.getElementById("AnzKund20").innerHTML = "Anzahl Kunden (0-20 Jahren): " + kund20 + " Kunden";
        document.getElementById("AnzKund40").innerHTML = "Anzahl Kunden (21-40 Jahren): " + kund40 + " Kunden";
        document.getElementById("AnzKund60").innerHTML = "Anzahl Kunden (41-60 Jahren): " + kund60 + " Kunden";
        document.getElementById("AnzKund80").innerHTML = "Anzahl Kunden (61-80 Jahren): " + kund80 + " Kunden";
        document.getElementById("AnzKund99").innerHTML = "Anzahl Kunden (80+ Jahren): " + kund99 + " Kunden";
    }
    function Altersdurschschnitt(data){
        let jahr = new Date().getFullYear();
        let monat = (new Date().getMonth()) + 1;
        let tag = new Date().getDate();
        let alter = 0;
        for (let i = 0; i < data.length; i++) {
            geb = data[i].geburtsdatum;
            gebjahr = JSON.stringify(geb);
            gebjahr = gebjahr.substring(1, 5);
            gebjahr = parseInt(gebjahr)
            gebmonat = JSON.stringify(geb)
            gebmonat = geb.substring(6, 8);
            gebmonat = parseInt(gebmonat);
            gebtag = JSON.stringify(geb)
            gebtag = gebtag.substring(9, 11);
            gebtag = parseInt(gebtag);
            if(monat <= gebmonat && tag <= gebtag ){
                jahr = jahr - 1;
            };
            alt = jahr - gebjahr;
            alter = alter + alt;
        };
        document.getElementById("Alter").innerHTML = "Durchschnittsalter: "+ (alter/data.length) + " Jahre";
    }
    //Auftrag Statistik
    function Auftrag(){
        doGetRequest(
            '/api/auftrags',
            "",
            (data) => {   // func
                anzAuftragZeig(data);
                AufKun(data);
            }); 
    }
    function anzAuftragZeig(data){
        debugger;
        document.getElementById("anzAuftrag").innerHTML = "Anzahl Aufträge: " + data.length +" Aufträge";
    }
    function AufKun(data){
        let Auftrag = data.length;
        doGetRequest(
            '/api/kundes',
            "",
            (data) => {   // func
                AufKunZeig(Auftrag,data);
            }); 
    }
    function AufKunZeig(Auftrag,data){
        document.getElementById("anzAuftragKund").innerHTML = "Anzahl Aufträge pro Kunde: " + (Auftrag/data.length) +" Aufträge";
    }
</script>

</html>