<!DOCTYPE html>
<html lang="de" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}"></title>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" th:href="@{/css/startseite-style.css}"/>
    <script th:src="@{/scripts/main.js}" type="text/javascript"></script>
</head>
<body>
<div class="title-bar">
    <h1 class="heading">Kunde</h1>
</div>

<div class="vertical-bar">
    <p></p>
</div>

<div class="customerButton-searchField">
    <div class="customers">
        <button class="button customer-button" onclick="openLink('/auftrag')" type="button">Auftrag</button>
    </div>

    <div class="search-fields">
        <input class="input" id="lastname" placeholder="Name" required type="text"/><br>
        <input class="input" id="name" placeholder="Vorname" required type="text"/><br>
        <button class="button submit-button" onclick="searchCustomer()" onkeypress="enterPressed(e)" type="submit">
            Suchen
        </button>
    </div>
</div>

<div class="table-container"></div>

<div class="direction-buttons">
    <button class="button direction-button" onclick="openLink('./')">Startseite</button>
    <button class="button direction-button" onclick="openLink('/neuer-kunde')">Neuer Kunde</button>
    <button class="button direction-button" onclick="openLink('/organisation')">Organisation</button>
    <button class="button direction-button" onclick="openLink('/führerscheinsehtest')">Führerschein-Sehtest</button>
</div>

</body>
<script>
    function enterPressed(e) {
        document.getElementById("name").addEventListener("keydown", function (e) {
            let keyCode = e.code;
            if (keyCode === 13) {
                // enter pressed
                searchCustomer();
            }
        }, false);
    }

    function searchCustomer() {
        let name = document.getElementById('name').value;
        let lastname = document.getElementById('lastname').value;

        if (name === '' && lastname === '') {
            document.getElementById('name').style.border = '3px solid red';
            document.getElementById('lastname').style.border = '3px solid red';

            return false;
        } else if (name === '' && lastname !== '') {
            document.getElementById('name').style.border = '3px solid red';
            document.getElementById('lastname').style.border = '1px solid black';

            return false;
        } else if (lastname === '' && name !== '') {
            document.getElementById('name').style.border = '1px solid black';
            document.getElementById('lastname').style.border = '3px solid red';

            return false;
        } else {
            document.getElementById('name').style.border = '1px solid black';
            document.getElementById('lastname').style.border = '1px solid black';
        }

        doGetRequest(
            '/api/kundes/',
            (lastname + '/' + name),
            (data) => {   // func
                createTable(data, lastname, name);
            });
    }

    function createTable(data, lastname, name) {
        if (document.getElementsByClassName('table-container')[0].firstElementChild !== null) {
            const entries = document.getElementsByTagName('TD');

            if (entries[2].innerHtml === lastname && entries[3].innerHTML === name) {
                return false;
            }

            for (let i = 0; i <= entries.length; i++) {
                const values = Object.values(data);

                entries[i].innerHTML = values[i];
            }
        } else {
            let tableContainer = document.getElementsByClassName('table-container')[0];
            let table = document.createElement('TABLE');
            let tableHead = document.createElement('THEAD');
            let tableBody = document.createElement('TBODY');

            table.appendChild(tableHead);
            table.appendChild(tableBody);

            let headerRow = document.createElement('TR');

            if (data.length > 1) {
                const keys = Object.keys(data[0]);

                keys
                    .map((item) => {
                        let th = document.createElement('TH');
                        let caps = item.charAt(0).toUpperCase() + item.slice(1);
                        th.innerHTML = caps.valueOf();
                        headerRow.appendChild(th);
                    });

                tableHead.appendChild(headerRow);

                for (let i = 0; i < data.length; i++) {
                    let dataRow = document.createElement('TR');

                    const values = Object.values(data[i]);

                    values
                        .map((item) => {
                            let td = document.createElement('TD');
                            td.innerHTML = item.valueOf();
                            dataRow.appendChild(td);
                        });

                    tableBody.appendChild(dataRow)
                }
            } else {
                let dataRow = document.createElement('TR');

                const keys = Object.keys(data[0]);
                const values = Object.values(data[0]);

                keys
                    .map((item) => {
                        let th = document.createElement('TH');
                        let caps = item.charAt(0).toUpperCase() + item.slice(1);
                        th.innerHTML = caps.valueOf();
                        headerRow.appendChild(th);
                    });

                values
                    .map((item) => {
                        let td = document.createElement('TD');
                        td.innerHTML = item.valueOf();
                        dataRow.appendChild(td);
                    });

                tableHead.appendChild(headerRow);
                tableBody.appendChild(dataRow)
            }

            tableContainer.appendChild(table);
        }
    }
</script>
</html>